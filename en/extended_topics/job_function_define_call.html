
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="OneFlow: a efficient distributed deep learning framework.">
      
      
        <link rel="canonical" href="https://docs.oneflow.org/extended_topics/job_function_define_call.html">
      
      
      <link rel="shortcut icon" href="../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.0.2">
    
    
      
        <title>The Definition and Call of Job Function - OneFlow</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.38780c08.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f72e892.min.css">
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#the-definition-and-call-of-job-function" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
    <nav class="md-header-nav md-grid" aria-label="Header">
      <a href="https://docs.oneflow.org/" title="OneFlow" class="md-header-nav__button md-logo" aria-label="OneFlow" style="display:none">
        
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89"><path d="M3.136 17.387v42.932l42.932 21.467L3.136 17.387z"/><path d="M21.91 8l42.933 64.398-18.775 9.388L3.136 17.387 21.91 8z" fill-opacity=".5"/><path d="M67.535 17.387L40.273 35.543l21.878 32.818 5.384 2.691V17.387z"/><path d="M67.535 17.387v53.666l18.774-9.388V8l-18.774 9.387z" fill-opacity=".25"/></svg>

      </a>
      <label class="md-header-nav__button md-icon" for="__drawer">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
      </label>
      <div class="md-header-nav__title" data-md-component="header-title">
        
          <div class="md-header-nav__ellipsis">
            <span class="md-header-nav__topic md-ellipsis">
              OneFlow
            </span>
            <span class="md-header-nav__topic md-ellipsis">
              
                The Definition and Call of Job Function
              
            </span>
          </div>
        
      </div>
      
        <label class="md-header-nav__button md-icon" for="__search">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        </label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
      
        <div class="md-header-nav__source">
          
<a href="https://www.github.com/oneflow-Inc/oneflow" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    OneFlow
  </div>
</a>
        </div>
      
    </nav>
  </header>
  
    
    <div class="md-container" data-md-component="container">
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../index.html" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../quick_start/install.html" class="md-tabs__link">
          Quick Start
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../basics_topics/data_input.html" class="md-tabs__link">
          Basic Topics
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="job_function_define_call.html" class="md-tabs__link md-tabs__link--active">
          Extended Topics
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="https://oneflow.readthedocs.io/en/master/" class="md-tabs__link">
          API
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../contribute/intro.html" class="md-tabs__link">
          Contribute
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../index.html" class="md-tabs__link">
          中文
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://docs.oneflow.org/" title="OneFlow" class="md-nav__button md-logo" aria-label="OneFlow">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89"><path d="M3.136 17.387v42.932l42.932 21.467L3.136 17.387z"/><path d="M21.91 8l42.933 64.398-18.775 9.388L3.136 17.387 21.91 8z" fill-opacity=".5"/><path d="M67.535 17.387L40.273 35.543l21.878 32.818 5.384 2.691V17.387z"/><path d="M67.535 17.387v53.666l18.774-9.388V8l-18.774 9.387z" fill-opacity=".25"/></svg>

    </a>
    OneFlow
  </label>
  
    <div class="md-nav__source">
      
<a href="https://www.github.com/oneflow-Inc/oneflow" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    OneFlow
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../index.html" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Quick Start
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Quick Start" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Quick Start
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../quick_start/install.html" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../quick_start/quickstart_in_3_min.html" class="md-nav__link">
      Quick Start in 3 Minutes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../quick_start/lenet_mnist.html" class="md-nav__link">
      Recognition of MNIST Handwritten Digits
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Basic Topics
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Basic Topics" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Basic Topics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../basics_topics/data_input.html" class="md-nav__link">
      Data Input
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../basics_topics/build_nn_with_op_and_layer.html" class="md-nav__link">
      Build a Neural Network
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../basics_topics/optimizer_in_function_config.html" class="md-nav__link">
      Optimization Algorithm and Parameter Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../basics_topics/async_get.html" class="md-nav__link">
      Get results from job function
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../basics_topics/model_load_save.html" class="md-nav__link">
      Loading and saving of model
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../basics_topics/distributed_train.html" class="md-nav__link">
      Distributed training
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../basics_topics/concept_explanation.html" class="md-nav__link">
      Term & Concept Explanation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../basics_topics/essentials_of_oneflow.html" class="md-nav__link">
      OneFlow System Design
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Extended Topics
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Extended Topics" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Extended Topics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        The Definition and Call of Job Function
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="job_function_define_call.html" class="md-nav__link md-nav__link--active">
      The Definition and Call of Job Function
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-relationship-between-job-function-and-running-process-of-oneflow" class="md-nav__link">
    The Relationship Between Job Function and Running Process of OneFlow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-definition-of-job-function" class="md-nav__link">
    The Definition of Job Function
  </a>
  
    <nav class="md-nav" aria-label="The Definition of Job Function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-parameters-of-oneflowglobal_function" class="md-nav__link">
    The Parameters of oneflow.global_function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#placeholder" class="md-nav__link">
    PlaceHolder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-return-value-of-the-job-function" class="md-nav__link">
    The Return Value of the Job Function
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-call-of-job-function" class="md-nav__link">
    The Call of Job Function
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="consistent_mirrored.html" class="md-nav__link">
      Consistent & Mirrored View
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="model_mixed_parallel.html" class="md-nav__link">
      Features of Parallelism in OneFlow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="ofrecord.html" class="md-nav__link">
      The OFRecord Data Format
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="how_to_make_ofdataset.html" class="md-nav__link">
      Loading and Preparing OFRecord Dataset
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="how_to_convert_image_to_ofrecord.html" class="md-nav__link">
      Convert Image Files to OFRecord Datasets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="watch_watch_diff.html" class="md-nav__link">
      Obtain Runtime Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="debug_by_vscode.html" class="md-nav__link">
      Use VS Code to Debug OneFlow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="user_op.html" class="md-nav__link">
      User Defined OP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="oneflow_convert_tools.html" class="md-nav__link">
      OneFlow And ONNX Convert
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      API
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="API" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="https://oneflow.readthedocs.io/en/master/" class="md-nav__link">
      API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Contribute
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Contribute" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Contribute
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../contribute/intro.html" class="md-nav__link">
      Contribute to OneFlow
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      中文
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="中文" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        中文
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../index.html" class="md-nav__link">
      中文
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-relationship-between-job-function-and-running-process-of-oneflow" class="md-nav__link">
    The Relationship Between Job Function and Running Process of OneFlow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-definition-of-job-function" class="md-nav__link">
    The Definition of Job Function
  </a>
  
    <nav class="md-nav" aria-label="The Definition of Job Function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-parameters-of-oneflowglobal_function" class="md-nav__link">
    The Parameters of oneflow.global_function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#placeholder" class="md-nav__link">
    PlaceHolder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-return-value-of-the-job-function" class="md-nav__link">
    The Return Value of the Job Function
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-call-of-job-function" class="md-nav__link">
    The Call of Job Function
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/OneFlow-Inc/oneflow-documentation/blob/master/en/docs/extended_topics/job_function_define_call.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="the-definition-and-call-of-job-function">The Definition and Call of Job Function<a class="headerlink" href="#the-definition-and-call-of-job-function" title="Permanent link">&para;</a></h1>
<p>In OneFlow, we encapsulate the training, inference and some other tasks into a "job function". The job function is used to connect the user's business logic and the computing resource managed by OneFlow. </p>
<p>In OneFlow, the function decorated by <code>@oneflow.global_function</code> decorator is the OneFlow's job function</p>
<p>We mainly define the structure of the model and choose the optimization target in job function. In addition, we can also pass some hyperparameters about training and some configuration of the environment to the job function (like the following example: <code>get_train_config()</code>), OneFlow will manage the memory, GPU and other computing resource according to our configuration.</p>
<p>In this article, we will specifically learn about:</p>
<ul>
<li>
<p>how to define and call the job function</p>
</li>
<li>
<p>how to get the return value of job function</p>
</li>
</ul>
<h2 id="the-relationship-between-job-function-and-running-process-of-oneflow">The Relationship Between Job Function and Running Process of OneFlow<a class="headerlink" href="#the-relationship-between-job-function-and-running-process-of-oneflow" title="Permanent link">&para;</a></h2>
<p>The job function is divided into two phases: definition and call.</p>
<p>It's related to OneFlow's operating mechanism. Briefly, the OneFlow Python layer API simply describes the configuration and the training environment of the model. These information will pass to the C++ backend. After compilation, graph building and so on, the computation graph is obtained. Finally, the job function will be executed in OneFlow runtime.</p>
<p>The job function describes the model and the training environment. In this phase there's no data. We can only define the shape and data type of the nodes (as known as <strong>PlaceHolder</strong>) for creating and compiling the computation graph of OneFlow.</p>
<p>The job function will be called after the OneFlow runtime starts. We can pass the data by calling job function and get the results. </p>
<p>We will introduce the definition and calling method of job functions in detail as below. </p>
<h2 id="the-definition-of-job-function">The Definition of Job Function<a class="headerlink" href="#the-definition-of-job-function" title="Permanent link">&para;</a></h2>
<p>We encapsulate the model in Python and use <code>oneflow.global_function</code> to decorate. Then the definition is completed.</p>
<p>The job function mainly describes two things:</p>
<ul>
<li>
<p>The structure of model</p>
</li>
<li>
<p>The optimizing target in training phase</p>
</li>
</ul>
<p>In the following code, we build a Multi-Layer Perceptron model and use <code>flow.nn.sparse_softmax_cross_entropy_with_logits</code> to compute the cross-entropy loss as our optimizing target.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@flow</span><span class="o">.</span><span class="n">global_function</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">train_job</span><span class="p">(</span>
    <span class="n">images</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Numpy</span><span class="o">.</span><span class="n">Placeholder</span><span class="p">((</span><span class="n">BATCH_SIZE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">flow</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
    <span class="n">labels</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Numpy</span><span class="o">.</span><span class="n">Placeholder</span><span class="p">((</span><span class="n">BATCH_SIZE</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">flow</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tp</span><span class="o">.</span><span class="n">Callback</span><span class="p">[</span><span class="n">tp</span><span class="o">.</span><span class="n">Numpy</span><span class="p">]:</span>
    <span class="c1"># mlp</span>
    <span class="n">initializer</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">truncated_normal</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">reshape</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="p">[</span><span class="n">images</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">hidden</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span>
        <span class="n">reshape</span><span class="p">,</span>
        <span class="mi">512</span><span class="p">,</span>
        <span class="n">activation</span><span class="o">=</span><span class="n">flow</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">,</span>
        <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">initializer</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">logits</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span>
        <span class="n">hidden</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">initializer</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;output&quot;</span>
    <span class="p">)</span>

    <span class="n">loss</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">sparse_softmax_cross_entropy_with_logits</span><span class="p">(</span>
        <span class="n">labels</span><span class="p">,</span> <span class="n">logits</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;softmax_loss&quot;</span>
    <span class="p">)</span>
    <span class="n">lr_scheduler</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">PiecewiseConstantScheduler</span><span class="p">([],</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">])</span>
    <span class="n">flow</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">lr_scheduler</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loss</span>
</code></pre></div>
<h3 id="the-parameters-of-oneflowglobal_function">The Parameters of <code>oneflow.global_function</code><a class="headerlink" href="#the-parameters-of-oneflowglobal_function" title="Permanent link">&para;</a></h3>
<p><code>oneflow.global_function</code> decorator accepts two parameters, <code>type</code> and <code>function_config</code>. </p>
<ul>
<li>The parameter <code>type</code> accepts a string, which can only set as <code>train</code> or <code>predict</code>. When we define a training model, we set it as <code>train</code>. We set is as <code>predict</code> when we define a model for testing or inferencing. </li>
<li>The parameter <code>function_config</code> accepts an object which is constructed by <code>oneflow.function_config()</code>. In <code>function_config</code> object, we can use its method or attribute to config. As the following code. </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_train_config</span><span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">function_config</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">default_data_type</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config</span>
</code></pre></div>
<p>We set the default data type, then, we can pass the <code>function_config</code> object to the <code>global_function</code> decorator. </p>
<div class="highlight"><pre><span></span><code><span class="nd">@flow</span><span class="o">.</span><span class="n">global_function</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">function_config</span><span class="o">=</span><span class="n">get_train_config</span><span class="p">())</span>
<span class="k">def</span> <span class="nf">train_job</span><span class="p">(</span>
    <span class="n">images</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Numpy</span><span class="o">.</span><span class="n">Placeholder</span><span class="p">((</span><span class="n">BATCH_SIZE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">flow</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
    <span class="n">labels</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">Numpy</span><span class="o">.</span><span class="n">Placeholder</span><span class="p">((</span><span class="n">BATCH_SIZE</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">flow</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tp</span><span class="o">.</span><span class="n">Numpy</span><span class="p">:</span>
</code></pre></div>
<p>For the complete code, you can refer to <a href="consistent_mirrored.html">Consistent and Mirrored</a>'s  <a href="../code/extended_topics/hybrid_parallelism_mlp.py">mixed_parallel_mlp.py</a></p>
<h3 id="placeholder">PlaceHolder<a class="headerlink" href="#placeholder" title="Permanent link">&para;</a></h3>
<p>Noted that the <code>images</code>、<code>logits</code>、<code>labels</code>、<code>loss</code> and some other objects have no data in our definition of the job function. They are used to describe <strong>the shape and attribute of data</strong>, which is called <strong>PlaceHolder</strong>.</p>
<p>For the parameters of the job function, we use <code>Numpy.Placeholder</code>, <code>ListNumpy.Placeholder</code>, <code>ListListNumpy.Placeholder</code> in the <code>oneflow.typing</code> package to annotate the data type of them as <code>numpy.ndarray</code>, <code>Sequence[numpy.ndarray]</code> and <code>Sequence[Sequence[numpy.ndarray]]</code> respectively.</p>
<p>Besides the types of <code>oneflow.typing</code>, the variables returned from OneFlow operators or layers in the job function, like the <code>reshape</code>、<code>hidden</code>、<code>logits</code>、<code>loss</code> in the code above, are also PlaceHolder.</p>
<p>All the variables mentioned above inherit the base class <code>BlobDef</code> directly or indirectly. We call this object type as <strong>Blob</strong> in OneFlow. </p>
<p>The <strong>Blob</strong> has no data when defining the job function. It only plays the role of data placeholder for building the graph.</p>
<h3 id="the-return-value-of-the-job-function">The Return Value of the Job Function<a class="headerlink" href="#the-return-value-of-the-job-function" title="Permanent link">&para;</a></h3>
<p>The concept of the data placeholder <strong>Blob</strong> is emphasized above because the return value of the job function cannot be arbitrarily specified. It must be <code>Blob</code> type object or a container which only contains the <code>Blob</code> object. </p>
<p>For example, the <code>loss</code> returned in the above code is a <code>Blob</code> object</p>
<p>The return values of job function should be annotated. As an example, <code>-&gt; tp.Numpy</code> in above code means the function returns a <code>Blob</code> object.</p>
<p>As another example, we can annotate the return value type as <code>-&gt; Tuple[tp.Numpy, tp.Numpy]</code>.It means the function returns a <code>tuple</code> which contains two <code>Blob</code> object</p>
<p>You can refer to <a href="../basics_topics/async_get.html">Get the result of the job function</a> for specific examples.</p>
<h2 id="the-call-of-job-function">The Call of Job Function<a class="headerlink" href="#the-call-of-job-function" title="Permanent link">&para;</a></h2>
<p>OneFlow uses decorator to convert Python function into OneFlow's job function. It is transparent to user.</p>
<p>We can call the job function just like we call a Python function. Every time we call the job function, OneFlow will complete the forward propagation, back propagation, parameter updates, and more in framework. </p>
<p>In the code below. When we get the data, we will pass parameters and call the <code>train_job</code> function to print <code>loss</code>. </p>
<div class="highlight"><pre><span></span><code>    <span class="p">(</span><span class="n">train_images</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">),</span> <span class="p">(</span><span class="n">test_images</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">load_mnist</span><span class="p">(</span>
        <span class="n">BATCH_SIZE</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">train_images</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)):</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">train_job</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">20</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">loss</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</code></pre></div>
<p>As you can see, by calling the job function <code>train_job</code>, the <code>numpy</code> data is directly returned.</p>
<p>The method shown above is synchronous. OneFlow also supports asynchronous invocation. For more details you can refer to the article <a href="../basics_topics/async_get.html">Get the result of the job function</a>.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../basics_topics/essentials_of_oneflow.html" title="OneFlow System Design" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                OneFlow System Design
              </div>
            </div>
          </a>
        
        
          <a href="consistent_mirrored.html" title="Consistent & Mirrored View" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Consistent & Mirrored View
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 - 2020 OneFlow
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      <style>
    .ver-select:focus {
        color: gray;
        border: 0px solid #fff;
        background-color: transparent;
    }

    .ver-select {
        color: white;
        border: 0px solid #fff;
        background-color: transparent;
    }
</style>

<div class="md-footer-social">
    <select class="ver-select" onchange="javascript:location.href=this.value;">
        <option> versions </option>
        <option value="https://docs.oneflow.org/en"> master </option>
        <option value="https://docs.oneflow.org/v0.3.0/en/"> v0.3.0 </option>
        <option value="https://docs.oneflow.org/v0.2.0/en/"> v0.2.0 </option>
    </select>
</div>    
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.77e55a48.min.js"></script>
      <script src="../assets/javascripts/bundle.9554a270.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ['navigation.tabs'],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>